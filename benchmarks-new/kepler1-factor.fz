#include "float_ops/mulfp64.fz"
#include "float_ops/addfp64.fz"
#include "float_ops/subfp64.fz"
#include "float_ops/minus.fz"

function kepler1_factor
  (x1' : ![6.0]num)
  (x2' : ![6.0]num)
  (x3' : ![6.0]num)
  (x4' : ![6.0]num)
{
  let [x1] = x1';
  let [x2] = x2';
  let [x3] = x3';
  let [x4] = x4';

  lb a23_factor = factor|
    lb a21_factor = factor|
      lb a19_factor = factor|
        lb a16_factor = factor|
          lb s11_factor = factor|
            lb a1 = mulfp64(x1, x4) in
            lb a3 = addfp64(|minus(x1), x2|) in
            lb a4 = addfp64(|a3, x3|) in
            lb a5 = subfp64(|a4, x4|) in
            // (* (* x1 x4) (- (+ (+ (- x1) x2) x3) x4))
            mulfp64(a1, a5),
            lb a7 = subfp64(|x1, x2|) in
            lb a8 = addfp64(|a7, x3|) in
            lb a9 = addfp64(|a8, x4|) in
            // (* x2 (+ (+ (- x1 x2) x3) x4))
            mulfp64(x2, a9)
          | in
          // (+ (* (* x1 x4) (- (+ (+ (- x1) x2) x3) x4)) (* x2 (+ (+ (- x1 x2) x3) x4)))
          addfp64(s11_factor),
          lb a12 = addfp64(|x1, x2|) in
          lb a13 = subfp64(|a12, x3|) in
          lb a14 = addfp64(|a13, x4|) in
          // (* x3 (+ (- (+ x1 x2) x3) x4))
          mulfp64(x3, a14)
        | in
        addfp64(a16_factor),
        lb a17 = mulfp64(x2, x3) in
        mulfp64(a17, x4)
      | in
      subfp64(a19_factor),
      mulfp64(x1, x3)
    | in
    subfp64(a21_factor),
    mulfp64(x1, x2)
  | in
  lb a23 = subfp64(a23_factor) in
  subfp64(|a23, x4|)
}

kepler1_factor[4,6.36][4,6.36][4,6.36][4,6.36]

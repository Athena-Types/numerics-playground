\section{Dynamic Semantics}

\subsection{Substitution-style Operational Semantics}
The following is defined over untyped terms. In particular, we define the
operational semantics rewrite relation $\mapsto$ to map from (untyped) \Lang
to (untyped) \Lang. In other words, untypable programs can step (but not
necessarily to values).

\begin{figure}
\begin{center}

\begin{equation*}
\begin{aligned}[c]
	\mathbf{op}(v) &\mapsto op(v)\\
	\pi_i\langle v_1,v_2 \rangle &\mapsto v_i \\
	(\lambda x.e) \ v &\mapsto e[v/x] \\
  \rnd k &\mapsto (k, \rho(k))
	%\factor v \ &\mapsto v
\end{aligned}
\quad
\begin{aligned}[c]
	\letassign x = v \ \tin \ e &\mapsto e[v/x] \\
  \letpair (x, y) = (v, w) \ \tin \ e &\mapsto e[v/x][w/y] \\
  \letcobind x = [v] \ \tin \ e &\mapsto e[v/x] \\
  \ret v &\mapsto (v, v)
	%\letbind x = \ret v \ \tin \ e &\mapsto e[v/x] \\
\end{aligned}
\end{equation*}
% \vskip -1em
% \begin{align*}
%   \letbind y = (\letbind x = v \ \tin \ f) \ \tin \ g &\mapsto \letbind x = v \ \tin \ \letbind y = f \ \tin \ g \quad x\notin FV(g) 
% \end{align*}
\vskip -1em
\begin{align*}
	\mathbf{case} \ (\mathbf{in}_i \ v) \ \mathbf{of} \ (\mathbf{in}_1 \ x.e_1 \ | \ \mathbf{in}_2 \ x.e_2 )  &\mapsto e_i[v/x]
   \\
  \factor ((v_1, v_2), (v_3, v_4)) &\mapsto ((v_1, v_3), (v_2, v_4))
\end{align*}
  \vskip -0.25em
  \AXC{$e \mapsto e'$}
  \UIC{$C[e] \mapsto C[e']$}
	\DisplayProof
	
  \vskip 0.4em
  \AXC{$f[v_1/x] \mapsto^* (v_3, v_4)$}
  \AXC{$f[v_2/x] \mapsto^* (v_5, v_6)$}
  \BIC{$\letbind x = (v_1, v_2) \ \tin \ f \mapsto (v_3, v_6)$}
  \DisplayProof

	% \AXC{$e_1 \mapsto e_1'$}
	% \AXC{$e_2 \mapsto e_2'$}
	%  \BIC{$(e_1, e_2) \mapsto (e_1', e_2')$}
	% \DisplayProof
	%
	%  \vskip 0.4em
	% \AXC{$e_1 \mapsto e_1'$}
	% \AXC{$e_2 \mapsto e_2'$}
	%  \BIC{$\langle e_1, e_2 \rangle \mapsto \langle e_1', e_2' \rangle$}
	% \DisplayProof
\end{center}
    \caption{Substitution-style evaluation rules for \Lang. Parameterized for $i
    \in \{1, 2 \}$. $op$ is a higher-order metavar. When bolded $\mathbf{op}$
    refers to the syntax and when italicized $op$ refers to the corresponding
    function mapping syntactic values to syntactic values.}
    \label{fig:sub_eval_rules}
\end{figure}
